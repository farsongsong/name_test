<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹¬ì¿µ! ì´ë¦„ ê¶í•© í…ŒìŠ¤íŠ¸</title>
    <script src="https://unpkg.com/hangul-js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');

        :root {
            --primary-color: #ff758c;
            --secondary-color: #ff7eb3;
            --bg-gradient: linear-gradient(135deg, #fae1e1 0%, #e3e6ff 100%);
            --text-color: #444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Pretendard', sans-serif;
        }

        body {
            background: var(--bg-gradient);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: var(--text-color);
        }

        .main-container {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 40px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 100%;
            padding: 50px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .header p {
            font-size: 16px;
            color: #888;
            margin-bottom: 40px;
        }

        /* ì…ë ¥ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .input-group {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .input-wrapper {
            position: relative;
            flex: 1;
        }

        input {
            width: 100%;
            padding: 18px;
            border: 2px solid #eee;
            border-radius: 20px;
            font-size: 20px;
            text-align: center;
            font-weight: 700;
            transition: all 0.3s;
            background: #fdfdfd;
        }

        input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 5px 15px rgba(255, 117, 140, 0.2);
        }

        .heart-icon {
            font-size: 28px;
            color: var(--primary-color);
            animation: beat 1s infinite;
        }

        @keyframes beat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .btn-start {
            width: 100%;
            padding: 20px;
            background: linear-gradient(to right, #ff758c, #ff7eb3);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 20px;
            font-weight: 800;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 10px 20px rgba(255, 117, 140, 0.3);
        }

        .btn-start:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 25px rgba(255, 117, 140, 0.4);
        }

        /* í”¼ë¼ë¯¸ë“œ ì• ë‹ˆë©”ì´ì…˜ ìŠ¤íƒ€ì¼ */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .section-title {
            font-size: 20px;
            margin-bottom: 30px;
            color: #666;
        }

        .section-title span {
            color: var(--primary-color);
            font-weight: 800;
        }

        .pyramid-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            margin: 30px 0;
        }

        .row {
            display: flex;
            gap: 6px;
            animation: slideUp 0.4s ease forwards;
        }

        .node {
            width: 42px;
            height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fff;
            border-radius: 12px;
            font-weight: 700;
            font-size: 16px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.05);
            border: 1px solid #eee;
        }

        .node.char {
            background: #fff0f3;
            border-color: #ffccd5;
            color: var(--primary-color);
            font-size: 18px;
        }

        .result-score {
            font-size: 50px;
            font-weight: 900;
            color: var(--primary-color);
            margin: 20px 0;
            display: none;
        }

        .result-score.show {
            display: block;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* ìµœì¢… ê²°ê³¼ ì¹´ë“œ */
        .final-card {
            padding: 40px 20px;
        }

        .final-score-circle {
            width: 180px;
            height: 180px;
            background: white;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin: 0 auto 30px;
            border: 8px solid var(--primary-color);
            box-shadow: 0 10px 30px rgba(255, 117, 140, 0.2);
        }

        .final-score-circle .val {
            font-size: 60px;
            font-weight: 900;
            color: var(--primary-color);
        }

        .comparison-wrap {
            display: flex;
            justify-content: space-around;
            margin-top: 30px;
        }

        .comp-item {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 15px;
            width: 45%;
        }

        .comp-item p { font-size: 13px; color: #888; }
        .comp-item div { font-size: 20px; font-weight: 700; color: #444; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { 
            from { opacity: 0; transform: translateY(10px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        @media (max-width: 480px) {
            .node { width: 34px; height: 34px; font-size: 14px; }
            .header h1 { font-size: 26px; }
        }
    </style>
</head>
<body>

<div class="main-container">
    <div id="inputView">
        <div class="header">
            <h1>ğŸ’• ì´ë¦„ ê¶í•© í…ŒìŠ¤íŠ¸</h1>
            <p>ìš°ë¦¬ì˜ ì¸ì—°ì€ ëª‡ í¼ì„¼íŠ¸ì¼ê¹Œìš”?</p>
        </div>

        <div class="input-group">
            <div class="input-wrapper">
                <input type="text" id="name1" placeholder="ì´ë¦„" maxlength="4">
            </div>
            <div class="heart-icon">â¤ï¸</div>
            <div class="input-wrapper">
                <input type="text" id="name2" placeholder="ì´ë¦„" maxlength="4">
            </div>
        </div>
        <button class="btn-start" onclick="startLoveTest()">ê²°ê³¼ í™•ì¸í•˜ê¸°</button>
    </div>

    <div class="content-section" id="section1">
        <div class="section-title">ë¨¼ì €, <span id="n1-title"></span>ì˜ ë§ˆìŒì€...</div>
        <div class="pyramid-container" id="pyramid1"></div>
        <div class="result-score" id="result1">0%</div>
        <button class="btn-start" style="margin-top: 20px;" onclick="goToSection2()">ë‹¤ìŒ í™•ì¸ â†’</button>
    </div>

    <div class="content-section" id="section2">
        <div class="section-title">ê·¸ë¦¬ê³ , <span id="n2-title"></span>ì˜ ë§ˆìŒì€...</div>
        <div class="pyramid-container" id="pyramid2"></div>
        <div class="result-score" id="result2">0%</div>
        <button class="btn-start" style="margin-top: 20px;" onclick="goToFinalResult()">ìµœì¢… ê²°ê³¼ ë³´ê¸°</button>
    </div>

    <div class="content-section" id="section3">
        <div class="final-card">
            <h2 style="margin-bottom: 20px;">ğŸ’˜ ìš°ë¦¬ì˜ ìµœì¢… ê¶í•© ğŸ’˜</h2>
            <div class="final-score-circle">
                <div class="val" id="finalScore">0%</div>
            </div>
            <div class="comparison-wrap">
                <div class="comp-item">
                    <p id="c-name1">ì´ë¦„1</p>
                    <div id="compare1">0%</div>
                </div>
                <div class="comp-item">
                    <p id="c-name2">ì´ë¦„2</p>
                    <div id="compare2">0%</div>
                </div>
            </div>
            <button class="btn-start" style="margin-top: 40px; background: #999;" onclick="location.reload()">ë‹¤ì‹œ í•˜ê¸°</button>
        </div>
    </div>
</div>

<script>
    const strokeCounts = {
        'ã„±': 2, 'ã„²': 4, 'ã„´': 2, 'ã„·': 3, 'ã„¸': 6, 'ã„¹': 5, 'ã…': 4, 'ã…‚': 4, 'ã…ƒ': 8, 'ã……': 2, 
        'ã…†': 4, 'ã…‡': 1, 'ã…ˆ': 3, 'ã…‰': 6, 'ã…Š': 4, 'ã…‹': 3, 'ã…Œ': 4, 'ã…': 4, 'ã…': 3,
        'ã…': 2, 'ã…': 3, 'ã…‘': 3, 'ã…’': 4, 'ã…“': 2, 'ã…”': 3, 'ã…•': 3, 'ã…–': 4, 'ã…—': 2, 'ã…˜': 4, 
        'ã…™': 5, 'ã…š': 3, 'ã…›': 3, 'ã…œ': 2, 'ã…': 4, 'ã…': 5, 'ã…Ÿ': 3, 'ã… ': 3, 'ã…¡': 1, 'ã…¢': 2, 'ã…£': 1
    };

    let s1 = 0, s2 = 0;
    let nameA = '', nameB = '';

    function getStrokes(char) {
        if (!char || char === 'â˜†') return 0;
        return Hangul.disassemble(char).reduce((acc, cur) => acc + (strokeCounts[cur] || 0), 0);
    }

    async function runPyramid(names, strokes, containerId, resultId) {
        const container = document.getElementById(containerId);
        const resultDiv = document.getElementById(resultId);
        container.innerHTML = '';
        
        // ê¸€ì ë¡œìš°
        const labelRow = document.createElement('div');
        labelRow.className = 'row';
        names.forEach(n => {
            const d = document.createElement('div');
            d.className = 'node char';
            d.innerText = n;
            labelRow.appendChild(d);
        });
        container.appendChild(labelRow);

        let current = strokes;
        while (current.length >= 2) {
            const rowDiv = document.createElement('div');
            rowDiv.className = 'row';
            current.forEach(num => {
                const n = document.createElement('div');
                n.className = 'node';
                n.innerText = num;
                rowDiv.appendChild(n);
            });
            container.appendChild(rowDiv);
            await new Promise(r => setTimeout(r, 400));
            
            if (current.length === 2) break;
            current = current.slice(0, -1).map((val, i) => (val + current[i+1]) % 10);
        }

        const score = current.join('');
        resultDiv.innerText = score + '%';
        resultDiv.classList.add('show');
        return parseInt(score);
    }

    async function startLoveTest() {
        nameA = document.getElementById('name1').value.trim();
        nameB = document.getElementById('name2').value.trim();
        if (!nameA || !nameB) return alert("ë‘ ì´ë¦„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!");

        document.getElementById('inputView').style.display = 'none';
        document.getElementById('section1').classList.add('active');
        document.getElementById('n1-title').innerText = nameA;

        let combined = [], strokes = [];
        const max = Math.max(nameA.length, nameB.length);
        for(let i=0; i<max; i++) {
            const c1 = nameA[i] || 'â˜†', c2 = nameB[i] || 'â˜†';
            combined.push(c1, c2);
            strokes.push(getStrokes(c1), getStrokes(c2));
        }
        s1 = await runPyramid(combined, strokes, 'pyramid1', 'result1');
    }

    async function goToSection2() {
        document.getElementById('section1').classList.remove('active');
        document.getElementById('section2').classList.add('active');
        document.getElementById('n2-title').innerText = nameB;

        let combined = [], strokes = [];
        const max = Math.max(nameA.length, nameB.length);
        for(let i=0; i<max; i++) {
            const c1 = nameA[i] || 'â˜†', c2 = nameB[i] || 'â˜†';
            combined.push(c2, c1);
            strokes.push(getStrokes(c2), getStrokes(c1));
        }
        s2 = await runPyramid(combined, strokes, 'pyramid2', 'result2');
    }

    function goToFinalResult() {
        document.getElementById('section2').classList.remove('active');
        document.getElementById('section3').classList.add('active');
        
        const final = Math.round((s1 + s2) / 2);
        document.getElementById('finalScore').innerText = final + '%';
        document.getElementById('c-name1').innerText = nameA + ' ìš°ì„ ';
        document.getElementById('c-name2').innerText = nameB + ' ìš°ì„ ';
        document.getElementById('compare1').innerText = s1 + '%';
        document.getElementById('compare2').innerText = s2 + '%';
    }
</script>

</body>
</html>
